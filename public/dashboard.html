<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
        crossorigin="anonymous">

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.16/css/uikit.min.css" />

    <!-- UIkit JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.16/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-rc.16/js/uikit-icons.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Montserrat|Raleway" rel="stylesheet">

    <link rel="stylesheet" href="./assets/css/style.css">
    <title>Document</title>
</head>

<body class="uk-offcanvas-content">
    <div uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky; bottom: #transparent-sticky-navbar">
        <nav class="uk-alert-danger uk-navbar-container uk-animation-slide-top" uk-navbar style="position: relative; z-index: 980;">
            <div class="uk-navbar-left uk-margin-left">
                <ul class="uk-navbar-nav">
                    <li class="uk-button" id='user-library-link'>My Library</li>
                    <li class="uk-button active" id='full-library-link'>Full Library</li>
                </ul>
            </div>
            <div class="uk-navbar-right">
                <form class="uk-form" action="" id="login">
                    Login: <input class="uk-input uk-width-1-4" id='username' type="text">
                    Password: <input class="uk-input uk-width-1-4" id='password' type="password">
                    <input class="uk-button" type="submit" id='submit-login' value="Login">
                    <input class="uk-button" type="button" value="Sign Up" id='sign-up-button' href="#sign-up-prompt" uk-toggle>
                </form>

            </div>
        </nav>
    </div>

    <!-- <header>
        <div class="library-links">
            <p id='user-library-link'>My Library</p>
            <p id='full-library-link' class='active'>Full Library</p>
        </div>
        <div class="login-container">
            <form action="">
                Login: <input id='username' type="text">
                Password: <input id='password' type="password">
                <input type="submit" id='submit-login' value="Login">
            </form>
            <input type="button" value="Sign Up" id='sign-up-button'>

    </header> -->
    <div id="landing">
        <h1 class="title uk-animation-fade"><span><img src="./assets/images/lapiconDARKblue.png" id="laptop"></span>Dev<span
                id="lab">Lab</span></h1>
        <!-- <p>Teach yourself how to code.</p> -->
    </div>

    </div>
    <hr class="uk-divider-icon" uk-scrollspy="cls:uk-animation-grow">
    <div class="uk-container" uk-scrollspy="target: > div; cls:uk-animation-slide-top-small; delay: 300">
        <div class="user-library-container">
            Library
            <p>User categories: All saved articles(sort by saves vs date added) AND saved workflows.</p>
        </div>

        <div class="library-container">
            <div class="concept-container">
                <h2  class = "uk-text-left">Concepts</h2>
                <!-- <div class="concept-category" id=concept-category1>
                <h4>Functions</h4>
            </div> -->
            </div>
            <div class="content-container">
                <h2 class = "uk-text-center">Content</h2>
                <div class="content-item-container" uk-scrollspy="target: > ul; cls:uk-animation-slide-right-medium; delay: 300">
                    <!-- 
                        <ul uk-accordion>
                        <li>
                            <a class="uk-accordion-title" href="#">For Loops <span class='star-number uk-align-right'>421
                                    <i class='fas fa-star star-image'></i></span></a>
                            <div class="uk-accordion-content content-item" data-id='1' id="content-item1">
                                <a>Sample Link</a>

                            </div>
                        </li>
                        <li>
                            <a class="uk-accordion-title" href="#">Conditionals<span class='star-number uk-align-right'>282
                                    <i class='fas fa-star star-image'></i></span>
                            </a>
                            <div class="uk-accordion-content content-item" data-id='1' id="content-item1">
                                <P>Lorem ipsum dolor sit amet consectetur adipisicing elit. Beatae ab deserunt deleniti ea delectus libero soluta facilis mollitia molestias <a>iusto.</a></P>
                            </div>
                        </li>
                    </ul>-->

                </div>
            </div>
        </div>
        <button class="uk-button uk-button-danger uk-align-center uk-width-1-1" type="button" uk-toggle="target: #add-content-slider">Add
            Content</button>

    </div>

    <div id="add-content-slider" uk-offcanvas="overlay: true">
        <div class="uk-offcanvas-bar">

            <button class="uk-offcanvas-close" type="button" uk-close></button>

            <div class="add-content uk-margin-large-top">
                <h2>Add Content</h2>
                <form class="uk-form-stacked" action="">
                    <div id="add-content-inputs">
                        <label class="uk-form-label" for="new-concept">Concept: </label>
                        <select class="uk-select" id="new-concept"></select>
                        <label class="uk-form-label" for="new-name">Title: </label>
                        <input class="uk-input" type="text" id='new-name'>
                        <label class="uk-form-label" for="new-link">Link: </label>
                        <input class="uk-input" type="text" id='new-link'>
                        <br>
                        <label class="uk-form-label" for="new-desc">Description: </label>
                        <textarea class="uk-textarea" type="text" id='new-desc'></textarea>
                    </div>

                    <input class="uk-button uk-button-danger uk-align-center" type="submit" id='submit-content' value="Add Content">
                </form>
            </div>


        </div>
    </div>

    <div class="sign-up-modal uk-flex-top" id = "sign-up-prompt" uk-modal>
        <div class="uk-modal-dialog uk-margin-auto-vertical">
            <button class="uk-modal-close-default" type="button" uk-close></button>
            <div class="uk-modal-header">
                <h2 class="uk-modal-title">Sign-Up for DevLab!</h2>
            </div>
            <div class="uk-modal-body">
                <form class = "uk-form" action="">
                    <label class="uk-form-label" for="userName">Username: </label>
                    <input class="uk-input" name='userName' type="text">
                    <label class="uk-form-label" for="userPassword">Password: </label>
                    <input class="uk-input" name='userPassword' type="password">
                    <label class="uk-form-label" for="userEmail">Email : </label>
                    <input class="uk-input" name='userEmail' type="text">
                </form>
            </div>
            <div class="uk-modal-footer uk-text-right">
                <input class="uk-button" type="button" value='Cancel' id="sign-up-cancel">
                <input class="uk-button" type="submit" value='Sign Up!' id="sign-up-submit">
            </div>
        </div>
    </div>
    <!-- <div class="screen-overlay"></div> -->
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous">







        </script>
    <script>
        $(function () {
            var userID;
            var loggedIn = true;

            $.get('/api/contents', function (err, data) {
                if (err) throw err;
                console.log(data);
            }).then(data => {
                //POPULATES CONCEPT CATEGORIES

                data.forEach(function (concept) {
                    var newDiv = $("<div class= 'concept-category'>");
                    var linkTitle = $(`<h4>`);
                    var dropdownOption = $(`<option value= ${concept.conceptTitle}>`)
                    newDiv.data('id', concept.id)
                    newDiv.attr('id', 'category-' + concept.conceptTitle)
                    linkTitle.text(concept.conceptTitle);
                    newDiv.append(linkTitle);
                    $(".concept-container").append(newDiv);
                    dropdownOption.text(concept.conceptTitle);
                    $('select').append(dropdownOption);
                });
            })
                .catch(err => console.log(err))



            //PAGE LOGIN
            $("#submit-login").on('click', function (e) {
                e.preventDefault();
                var username = $("#login").val();
                var password = $("#password").val();

                $.post('/login', {
                    username,
                    password
                }, function (data) {
                    //data should container userID
                    if (data) {
                        userID = data;
                        loggedIn = true;
                    } else {
                        //incorrect password
                    }
                })
            })
            //ON CLICK OF CONCEPTS, POPULATE CONTENT-ITEMS CONTAINER
            $(document).on('click', ".concept-category", function (e) {
                $(".content-item-container").empty();
                var category = $(this).attr('id');
                category = category.slice(category.indexOf('-') + 1);
                console.log(category);
                $.get('/api/contents/' + category, function (err, data) {
                    if (err) throw err;
                }).then(data => {
                    //CREATE INDIVIDUAL CONTENT ITEM DIV
                    //Items come in an array of objects and come in Most saves, DESC
                    var newAccordion = $("<ul uk-accordion>");
                    data.forEach(function (item) {
                        var newItem = $("<li class=content-item>")
                        var linkTitle = $(`<a class="uk-accordion-title" href="#">`); //${item.links}
                        var starNumber = $("<span class = star-number>");
                        var starImage = $("<i class='fas fa-star star-image'></i>");
                        var newDiv = $("<div class=uk-accordion-content>");

                        if (item.saved && loggedIn) starImage.addClass('saved');
                        starNumber.text(item.saves);
                        linkTitle.data('id', item.id);
                        starNumber.attr('id', 'content-item' + item.id);
                        starNumber.append(starImage);
                        linkTitle.text(item.contentTitle);
                        linkTitle.append(starNumber);
                        starNumber.addClass("uk-align-right");

                        newItem.append(linkTitle, newDiv);
                        newAccordion.append(newItem);
                        $(".content-item-container").prepend(newAccordion);
                    })
                })
            })

            //ON CLICK LISTENER FOR SAVING CONTENT
            $(document).on('click', ".star-image", function (e) {
                var starID = $(this).parent().data('id');
                var temp = $(`#content-item${starID}`).text()
                temp = parseInt(temp);
                //IF CONTENT IS BEING UNSAVED
                if ($(this).hasClass('saved')) {
                    $(this).removeClass('saved');
                    $(`#content-item${starID}`).text(temp - 1)
                    $.ajax(`/api/delete/${userID}/${starID}`, {
                        method: 'DELETE'
                    })
                    $.post('/user/resources/new/' + starID)

                } else {
                    $(`#content-item${starID}`).text(temp + 1)
                    //IF CONTENT IS BEING SAVED
                    $(this).addClass('saved')
                    $.ajax(`/api/save/${userID}/${starID}`, {
                        method: 'POST'
                    })
                }

            })

            //ADD NEW CONTENT
            $("#submit-content").on('click', function (e) {
                e.preventDefault();
                var createObj = {
                    content: $("#new-link").val(),
                    title: $("#new-name").val(),
                    category: $("select").val(),

                }
                $.post('/api/concept/new', createObj, function () {
                    //modal pop up - successfully submitted
                })

            })


            if (loggedIn) {
                $("#user-library-link").on('click', function () {
                    if (!$(this).hasClass('active')) {
                        $(this).toggleClass('active');
                        $("#full-library-link").toggleClass('active');
                        $(".library-container").hide();
                        $(".add-content").hide();
                        $(".user-library-container").css('display', 'block')
                        $.get(`/api/${userID}`, function (err, data) {
                            if (err) throw err;
                            //generate library div populated with 
                        })
                    }
                })
            }
            $("#full-library-link").on('click', function () {
                if (!$(this).hasClass('active')) {
                    $(this).toggleClass('active')
                    $("#user-library-link").toggleClass('active')
                    $(".library-container").show();
                    $(".add-content").show();
                    $(".user-library-container").css('display', 'none')
                }
            })

            $("#sign-up-button").on('click', function (e) {
                $(".sign-up-modal").css('display', 'flex');
                $(".screen-overlay").css('display', 'flex');
            })
            $("#sign-up-cancel").on('click', function (e) {
                $(".sign-up-modal").css('display', 'none');
                $(".screen-overlay").css('display', 'none');
            })
            $("#sign-up-submit").on('click', function (e) {
                e.preventDefault();
                var newUser = {
                    userName: $("input[name=userName]").val(),
                    userPassword: $("input[name=userPassword]").val(),
                    userEmail: $("input[name=userEmail]").val()
                }
                $.post('/api/new/users', newUser, function (resp) {
                    console.log(resp);
                    $("#sign-up-submit").css('display', 'none')
                    $(".sign-up-modal").html(
                        `Thank you ${resp.userName}! You've successfully signed up for DevLab. Please log in with your email ${resp.userEmail}`
                    )
                    $(document).on("click", ".sign-up-modal", () => {
                        $(".sign-up-modal").css('display', 'none');
                        $(".screen-overlay").css('display', 'none');

                    })
                })


                console.log(newUser);
            })


        })
    </script>
</body>

</html>